import{u as D}from"./resources-c352f549.js";import{r as t,i as N,j as Y,x as k,a as s,o as v,c as _,w as a,b as n,g as h,t as w,f as x,e as S,p as q,h as K}from"./index-29b1d87f.js";import{a as L}from"./axios-78cd9fea.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";const E=p=>(q("data-v-52a5fa19"),p=p(),K(),p),G=E(()=>S("h6",null,"You can always upload a new response",-1)),I=1,m=32,H={__name:"TaskResponseFileUploader",setup(p){const U="https://nem.bio:4000",f=t(0),g=t(null),o=t(null),R=D().resource;N(),Y();const b=t(localStorage.getItem("sessionId")),z=t(R.sessionId),e=t([]),u=t(!1),T=k(()=>e.value.reduce((r,l)=>r+l.size/1024/1024,0).toFixed(2)),F=k(()=>[()=>e.value.length<=I||`You can upload up to ${I} files.`,()=>T.value<=m||`Total file size must be under ${m} MB.`]),C=()=>{o.value=null,e.value.length>I?(o.value="You can upload only one file.",e.value=[]):T.value>m&&(o.value=`Total file size must not exceed ${m} MB.`,e.value=[])},B=async()=>{if(u.value=!0,f.value=0,o.value="",e.value.length===0){o.value="Please select files to upload.",u.value=!1;return}const r=new FormData;e.value.forEach(c=>{r.append("files",c)});const l="TASK_UPLOAD",i=`${U}/resources/uploads/task/response?userId=${encodeURIComponent(b.value)}&sessionId=${encodeURIComponent(z.value)}&questionType=${encodeURIComponent(l)}`;try{(await L.post(i,r,{onUploadProgress:d=>{const y=d.total||1;f.value=Math.round(d.loaded*100/y)}})).status===200&&(g.value="Task response saved successfully",o.value=null,setTimeout(()=>{window.location.href="tasks"},4200))}catch{o.value="Failed to upload files. Please try again."}finally{u.value=!1}};return(r,l)=>{const i=s("v-alert"),c=s("v-progress-linear"),d=s("v-card"),y=s("v-file-input"),V=s("v-icon"),$=s("v-btn"),M=s("v-col"),P=s("v-row"),j=s("v-container");return v(),_(j,null,{default:a(()=>[n(d,{flat:"",style:{"z-index":"99999 !important"}},{default:a(()=>[o.value?(v(),_(i,{key:0,border:"top",type:"warning",variant:"outlined",prominent:"",class:"ma-4",style:{"z-index":"99999 !important"}},{default:a(()=>[h(w(o.value),1)]),_:1})):x("",!0),u.value?(v(),_(c,{key:1,value:f.value,height:"6",color:"green darken-2",class:"mt-4"},null,8,["value"])):x("",!0),g.value?(v(),_(i,{key:2,border:"top",type:"success",class:"ma-4",style:{"z-index":"99999 !important"},variant:"outlined",prominent:""},{default:a(()=>[S("h4",null,w(g.value),1),G]),_:1})):x("",!0)]),_:1}),n(y,{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=A=>e.value=A),accept:".jpg, .jpeg, .png, .pdf",label:"Upload Assignment Responses","prepend-icon":"mdi-file-upload",multiple:!0,counter:!0,rules:F.value,chips:!0,onChange:C,"show-size":""},null,8,["modelValue","rules"]),n(P,{justify:"center",class:"mt-4"},{default:a(()=>[n(M,{cols:"auto"},{default:a(()=>[n($,{onClick:B,disabled:e.value.length===0||u.value},{default:a(()=>[n(V,{class:"mr-2"},{default:a(()=>[h("mdi-cloud-upload")]),_:1}),h("Upload TASK Response ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})}}},ee=O(H,[["__scopeId","data-v-52a5fa19"]]);export{ee as T};
