import{a as B}from"./axios-78cd9fea.js";import{I as J}from"./vue-qrcode-reader-2a2e687e.js";import{u as W}from"./users-6c6e41da.js";import{r,y as A,l as X,k as Y,a as n,o as l,c as d,w as t,b as s,u as b,d as C,e as _,t as V,f as u,g as v}from"./index-6b729fcd.js";import{b as M}from"./route-block-83d24a4e.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./apolloClient-3b54e56b.js";const ee={key:0,class:"mb-4"},oe=_("h3",null,"Scanned QR Code:",-1),te=_("h3",{class:"text-h6 mb-4"},"Login to your Account",-1),ae=_("div",{class:"text-caption"},[v(" Didn't receive your pin? "),_("p",null,"Call 254700378241")],-1),se={key:1},re={__name:"CheckRedeem",setup(T){const g={}.VITE_NGROK_URL,c=r(""),k=r(""),f=r(""),h=r(""),I=localStorage.getItem("userVendorRole"),m=r(!1),a=r(!1),S=r("");r("");const y=r(!1),L=r(""),$=W();A(()=>$.user);const q=A(()=>N(c.value)),E=()=>{const e=new URLSearchParams(window.location.search);L.value=e.get("process"),y.value=L.value==="AUTH"},G=async e=>{c.value=e[0].rawValue,q.value?(a.value=!0,await Q()):(k.value="invalid",m.value=!1,a.value=!1)},Q=async()=>{try{const e=`${g}/vendors/check`,o=await B.get(e,{params:{code:c.value}});m.value=o.data.status==="valid"}catch(e){console.error("Error fetching status:",e),k.value="Error fetching status",m.value=!1}finally{a.value=!1}},j=()=>{window.location.href="/"},F=async()=>{var o,i;a.value=!0,h.value=null;const e=N(c.value);if(e)try{const p=`${g}/vendors/redeem`,w=await B.post(p,{token:e},{params:{vendorId:localStorage.getItem("vendorId"),vendorPin:localStorage.getItem("vendorPin")}});f.value=w.data.message}catch(p){h.value=((i=(o=p.response)==null?void 0:o.data)==null?void 0:i.error)||"An error occurred while trying to redeem the voucher"}finally{a.value=!1}},N=e=>{if(!H(e))return console.error("Invalid URL format."),null;try{const o=new URL(e),i="e1ea-41-90-65-71.ngrok-free.app";return o.hostname===i?o.searchParams.get("code")||null:(console.error("URL domain does not match the expected domain."),null)}catch(o){return console.error("Error processing URL:",o),null}},H=e=>{try{return new URL(e),!0}catch{return!1}};return X(()=>{E()}),Y(c,e=>{e&&E()}),(e,o)=>{const i=n("v-divider"),p=n("v-otp-input"),w=n("v-sheet"),x=n("v-btn"),P=n("v-card"),K=n("v-dialog"),D=n("v-icon"),R=n("v-alert"),z=n("v-progress-linear");return l(),d(P,{class:"pa-4",outlined:""},{default:t(()=>[s(b(J),{style:{"max-height":"54vh"},onDetect:G}),s(i,{class:"my-4"}),c.value&&!a.value?(l(),C("div",ee,[oe,_("p",null,V(c.value),1)])):u("",!0),s(K,{modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=U=>y.value=U),class:""},{default:t(()=>[s(P,{color:"transparent",flat:"",class:"py-8 px-6 text-center mx-auto ma-4",elevation:"12","max-width":"400",width:"100%"},{default:t(()=>[te,s(w,{color:"surface"},{default:t(()=>[s(p,{modelValue:S.value,"onUpdate:modelValue":o[0]||(o[0]=U=>S.value=U),type:"password",variant:"solo"},null,8,["modelValue"])]),_:1}),s(x,{class:"my-4",color:"purple",height:"40",text:"Submit",variant:"flat",width:"70%",onClick:e.loginVendor},{default:t(()=>[v(" Submit ")]),_:1},8,["onClick"]),s(i),ae]),_:1})]),_:1},8,["modelValue"]),y.value?u("",!0):(l(),C("div",se,[b(I)==="VENDOR"?(l(),d(x,{key:0,color:"success",class:"mb-2",style:{color:"white"},"prepend-icon":"mdi-check-circle",onClick:F,variant:"outlined",loading:a.value,disabled:!m.value||a.value||f.value.length>1},{prepend:t(()=>[s(D,{color:"success"})]),default:t(()=>[v(" Redeem voucher ")]),_:1},8,["loading","disabled"])):u("",!0),b(I)!=="VENDOR"?(l(),d(x,{key:1,color:"success",class:"mb-2",style:{color:"white"},"prepend-icon":"mdi-check-circle",onClick:j,variant:"outlined",loading:a.value,disabled:!m.value||a.value},{prepend:t(()=>[s(D,{color:"success"})]),default:t(()=>[v(" Go to NEMBio App ")]),_:1},8,["loading","disabled"])):u("",!0)])),k.value==="invalid"?(l(),d(R,{key:2,type:"error",class:"mb-2",style:{color:"white"}},{default:t(()=>[v(" Invalid QR Code or URL ")]),_:1})):u("",!0),f.value.length>1?(l(),d(R,{key:3,type:"success",class:"mb-2",style:{color:"white"}},{default:t(()=>[v(" Redeem Response: "+V(f.value),1)]),_:1})):u("",!0),h.value?(l(),d(R,{key:4,type:"error",class:"mb-2",style:{color:"white"}},{default:t(()=>[v(" Redeem Response: "+V(h.value),1)]),_:1})):u("",!0),a.value?(l(),d(z,{key:5,indeterminate:"",color:"primary",class:"my-4"})):u("",!0)]),_:1})}}};const O={__name:"index",setup(T){return(g,c)=>(l(),C("div",null,[s(re)]))}};typeof M=="function"&&M(O);const me=Z(O,[["__scopeId","data-v-d734fc46"]]);export{me as default};
