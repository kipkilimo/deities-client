import{H as Y,i as It,r as Z,q as Pt,m as Dt,a as st,o as X,d as Bt,c as tt,w as K,e as ot,f as et,b as ut,u as Nt,F as Tt,N as pt}from"./index-6b729fcd.js";import{u as Lt}from"./resources-e1807ce6.js";import{C as nt,r as Ut}from"./chart-d498817c.js";import{_ as Ht}from"./_plugin-vue_export-helper-c27b6911.js";function bt(t){return typeof t=="function"}function dt(){}var at=function(t){this.previousValue=t,this.interrupted=!1,this.interruptHandlers=new Set};at.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},at.prototype.interrupt=function(){this.interrupted||(this.interrupted=!0,this.interruptHandlers.forEach(function(t){try{t()}catch{}}))},at.prototype.onInterrupt=function(t){if(this.interrupted&&!this.interruptHandlers.has(t))try{t()}catch{}this.interruptHandlers.add(t)};function it(t){return function(){return t}}function Ct(){return[]}var Vt={animationDuration:{type:Number,default:1e3},animationEasing:{type:String,default:"ease"},animationOverlap:{type:Number,default:1},color:{type:[String,Function],default:"Black"},createCanvas:{type:Function,default:function(){return document.createElement("canvas")}},createWorker:{type:Function,default:function(t){return new Worker(URL.createObjectURL(new Blob([t])))}},enterAnimation:{type:[Object,String],default:it({opacity:0})},fontFamily:{type:[String,Function],default:"serif"},fontSizeRatio:{type:Number,default:0},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},leaveAnimation:{type:[Object,String],default:it({opacity:0})},loadFont:{type:Function,default:function(t,r,a,o){return document.fonts.load([r,a,"1px",t].join(" "),o)}},rotation:{type:[Number,Function],default:0},rotationUnit:{type:[String,Function],default:"turn"},spacing:{type:Number,default:0},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},words:{type:Array,default:Ct}},$t=it(null);function lt(t){if(t){var r=typeof t;return r==="object"||r==="function"}return!1}function ft(t){return typeof t=="string"}var qt={animationOptions:function(){var t,r,a,o=this.animationDuration,e=this.enterAnimation,s=this.leaveAnimation;if(lt(e)&&lt(s)){var n=(t=Object.assign({},e,s),r=$t,a={},Object.entries(t).forEach(function(c){var v=c[0],F=c[1];a[v]=r(F,v,t)}),a),f=function(c){Object.assign(c.style,e)},b=function(c,v){setTimeout(function(){Object.assign(c.style,n),setTimeout(v,o)},1)};return{props:{css:!1},on:{beforeAppear:f,appear:b,beforeEnter:f,enter:b,leave:function(c,v){Object.assign(c.style,s),setTimeout(v,o)}}}}return ft(e)&&ft(s)?{props:{duration:o,appear:!0,appearActiveClass:e,enterActiveClass:e,leaveActiveClass:s}}:{}},normalizedAnimationOverlap:function(){var t=this.animationOverlap;return(t=Math.abs(t))<1&&(t=1/t),t},separateAnimationDelay:function(){var t=this.cloudWords;return t.length>1?(this.animationDuration-this.separateAnimationDuration)/(t.length-1):0},separateAnimationDuration:function(){var t=this.cloudWords;if(t.length>0){var r=this.animationDuration,a=this.normalizedAnimationOverlap;return r/Math.min(a,t.length)}return 0}},zt=Array.isArray;function H(t){return bt(t)?t:it(t)}var Mt=2*Math.PI,Gt=Mt/360;function V(t){return t===void 0}function Q(t,r){return t.postMessage(r),function(a){return new Promise(function(o,e){var s,n=function(b){var c=b.data;s(),o(c)},f=function(b){var c=b.error;s(),e(c)};s=function(){a.removeEventListener("message",n),a.removeEventListener("error",f)},a.addEventListener("message",n),a.addEventListener("error",f)})}(t)}function mt(t,r,a){return Math.ceil(t*Math.abs(Math.sin(a))+r*Math.abs(Math.cos(a)))}function vt(t,r,a){return Math.ceil(t*Math.abs(Math.cos(a))+r*Math.abs(Math.sin(a)))}function ct(t,r,a,o,e){return[t,r,a,o+"px",e].join(" ")}function gt(t,r){return Math.ceil(t/r)*r}function yt(t,r,a){var o=a().getContext("2d");return o.font=r,o.measureText(t).width}var wt=function(t,r,a,o,e,s,n){this.t=t,this.i=r,this.o=a,this.u=o,this.s=e,this.h=s,this.l=n,this.v=1,this.m=0,this.p=0,this.g=0},d={M:{configurable:!0},S:{configurable:!0},F:{configurable:!0},j:{configurable:!0},O:{configurable:!0},W:{configurable:!0},A:{configurable:!0},B:{configurable:!0},C:{configurable:!0},L:{configurable:!0},_:{configurable:!0},P:{configurable:!0},T:{configurable:!0},N:{configurable:!0},k:{configurable:!0},D:{configurable:!0},H:{configurable:!0},R:{configurable:!0},U:{configurable:!0}};d.M.get=function(){return this.v},d.M.set=function(t){this.v!==t&&(this.v=t,this.V=void 0)},d.S.get=function(){return ct(this.h,this.s,this.u,this.M,this.o)},d.F.get=function(){return this.q===void 0&&(this.q=yt(this.t,ct(this.h,this.s,this.u,1,this.o),this.l)),this.q},d.j.get=function(){return this.F*this.M},d.O.get=function(){return this.p*this.M},d.O.set=function(t){this.p=t/this.M},d.W.get=function(){return this.g*this.M},d.W.set=function(t){this.g=t/this.M},d.A.get=function(){return vt(this.j,this.M,this.i)},d.B.get=function(){return mt(this.j,this.M,this.i)},d.C.get=function(){return this.O-this.A/2},d.L.get=function(){return this.W-this.B/2},d._.get=function(){return this.m},d._.set=function(t){this.m!==t&&(this.m=t,this.V=void 0)},d.P.get=function(){return this.V===void 0&&(this.V=function(t,r,a,o,e,s,n,f,b){var c=ct(r,a,o,e*=4,s),v=n*e*2,F=v+yt(t,c,b),E=v+e,S=b(),g=S.getContext("2d"),j=gt(vt(F,E,f),4),T=gt(mt(F,E,f),4);S.width=j,S.height=T,g.translate(j/2,T/2),g.rotate(f),g.font=c,g.textAlign="center",g.textBaseline="middle",g.fillText(t,0,0),v>0&&(g.miterLimit=1,g.lineWidth=v,g.strokeText(t,0,0));for(var $=g.getImageData(0,0,j,T).data,q=[],L=1/0,G=0,U=1/0,J=0,m=j/4,C=T/4,h=0;h<m;++h)for(var i=0;i<C;++i)t:for(var w=0;w<4;++w)for(var O=0;O<4;++O)if($[4*(j*(4*i+O)+(4*h+w))+3]){q.push([h,i]),L=Math.min(h,L),G=Math.max(h+1,G),U=Math.min(i,U),J=Math.max(i+1,J);break t}return q.length>0?[q.map(function(_){var z=_[0],u=_[1];return[z-L,u-U]}),G-L,J-U,Math.ceil(m/2)-L,Math.ceil(C/2)-U]:[q,0,0,0,0]}(this.t,this.h,this.s,this.u,this.M,this.o,this._,this.i,this.l)),this.V},d.T.get=function(){return this.P[0]},d.N.get=function(){return this.P[1]},d.k.get=function(){return this.P[2]},d.D.get=function(){return this.P[3]},d.H.get=function(){return this.P[4]},d.R.get=function(){return Math.ceil(this.O)-this.D},d.R.set=function(t){this.O=t+this.D},d.U.get=function(){return Math.ceil(this.W)-this.H},d.U.set=function(t){this.W=t+this.H},Object.defineProperties(wt.prototype,d);var Jt={cloudWords:function(t){this.$emit("update:cloudWords",t)},progress:{handler:function(t){this.$emit("update:progress",t)},deep:!0,immediate:!0}},Kt={updateElementSize:function(){var t=this.$el;t&&(this.elementWidth=t.offsetWidth,this.elementHeight=t.offsetHeight)}},Qt={name:"VueWordCloud",mixins:[function(t){return{data:function(){var r={};return Object.keys(t).forEach(function(a){r["asyncComputed_trigger_"+a]={}}),r},computed:{},beforeCreate:function(){var r=this,a=new Set;Object.entries(t).forEach(function(o){var e=o[0],s=o[1],n=s.get,f=s.default,b=s.errorHandler;b===void 0&&(b=dt);var c,v=!0;r.$options.computed[e]=function(){return this["asyncComputed_trigger_"+e],this["asyncComputed_promise_"+e],f},r.$options.computed["asyncComputed_promise_"+e]=function(){var F=this;c&&(c.interrupt(),a.delete(c)),v&&(v=!1,bt(f)&&(f=f.call(this)));var E=new at(f);c=E,a.add(c),new Promise(function(S){S(n.call(F,E))}).then(function(S){E.throwIfInterrupted(),f=S,F["asyncComputed_trigger_"+e]={}}).catch(b)}})}}}({cloudWords:{get:function(t){var r,a=this,o=this,e=o.elementWidth,s=o.elementHeight,n=o.words,f=o.text,b=o.weight,c=o.rotation,v=o.rotationUnit,F=o.fontFamily,E=o.fontWeight,S=o.fontVariant,g=o.fontStyle,j=o.color,T=o.spacing,$=o.fontSizeRatio,q=o.createCanvas,L=o.loadFont,G=o.createWorker;r=$,$=(r=Math.abs(r))>1?1/r:r;var U=function(u){var y=u[0],W=u[1];return y>W?[1,W/y]:W>y?[y/W,1]:[1,1]}([e,s]);if(e>0&&s>0){var J=H(f),m=H(b),C=H(c),h=H(v),i=H(F),w=H(E),O=H(S),_=H(g),z=H(j);return n=n.map(function(u,y){var W,x,D,R,B,l,p,M,I,A,N;u&&(ft(u)?D=u:zt(u)?(D=(W=u)[0],R=W[1]):lt(u)&&(D=(x=u).text,R=x.weight,B=x.rotation,l=x.rotationUnit,p=x.fontFamily,M=x.fontWeight,I=x.fontVariant,A=x.fontStyle,N=x.color)),V(D)&&(D=J(u,y,n)),V(R)&&(R=m(u,y,n)),V(B)&&(B=C(u,y,n)),V(l)&&(l=h(u,y,n)),V(p)&&(p=i(u,y,n)),V(M)&&(M=w(u,y,n)),V(I)&&(I=O(u,y,n)),V(A)&&(A=_(u,y,n)),V(N)&&(N=z(u,y,n));var P=new wt(D,function(){switch(l){case"turn":return B*Mt;case"deg":return function(k){return k*Gt}(B)}return B}(),p,M,I,A,q);return Object.assign(P,{J:u,G:R,I:N}),P}),Promise.resolve().then(function(){return Promise.all(n.map(function(u){var y=u.o,W=u.h,x=u.u,D=u.t;return L(y,W,x,D)}))}).catch(dt).then(function(){if((n=n.filter(function(l){return l.j>0}).sort(function(l,p){return p.G-l.G})).length>0){var u=n[0],y=function(l){return l[p=l,p.length-1];var p}(n),W=u.G,x=y.G;if(x<W){var D=$>0?1/$:x>0?W/x:W<0?x/W:1+W-x;n.forEach(function(l){var p,M,I;l.M=(p=l.G,(I=1)+(p-(M=x))*(D-I)/(W-M))})}n.reduceRight(function(l,p){return p.M<2*l?p.M/=l:(l=p.M,p.M=1),p.K=l},1),n.forEach(function(l){l.M*=4});var R=G(`!function(){"use strict";var r=function(t){self.removeEventListener("message",r);var n,e,a,f,i,u=t.data,o=function(){n={},e=0,a=0,f=0,i=0};o();var s=function(){return Math.ceil((e+a)/2)},v=function(){return Math.ceil((f+i)/2)},c=function(){return{left:s(),top:v(),width:a-e,height:i-f}},l=function(r,t,u){r.forEach((function(r){var o=r[0],s=r[1],v=t+o,c=u+s;n[v+"|"+c]=!0,e=Math.min(v,e),a=Math.max(v+1,a),f=Math.min(c,f),i=Math.max(c+1,i)}))},h=function(r,t,e){return function(r,t,n){var e,a,f=r[0],i=r[1],u=t[0],o=t[1];f>i?(e=1,a=i/f):i>f?(a=1,e=f/i):e=a=1;var s=[u,o];if(n(s))return s;for(var v=u,c=o,l=u,h=o,M=v,d=c;;){u-=e,o-=a,v+=e,c+=a;var m=Math.floor(u),g=Math.floor(o),p=Math.ceil(v),E=Math.ceil(c);if(p>M)for(var L=g;L<E;++L){var x=[p,L];if(n(x))return x}if(E>d)for(var y=p;y>m;--y){var w=[y,E];if(n(w))return w}if(m<l)for(var B=E;B>g;--B){var F=[m,B];if(n(F))return F}if(g<h)for(var b=m;b<p;++b){var j=[b,g];if(n(j))return j}l=m,h=g,M=p,d=E}}(u,[t+s(),e+v()],(function(t){var e=t[0],a=t[1];return function(r,t,e){return r.every((function(r){var a=r[0],f=r[1];return!n[t+a+"|"+(e+f)]}))}(r,e,a)}))};self.postMessage({}),self.addEventListener("message",(function(r){self.postMessage({getBounds:c,put:l,findFit:h,clear:o}[r.data.name].apply(null,r.data.args))}))};self.addEventListener("message",r)}();
`),B={completedWords:0,totalWords:n.length};return Promise.resolve().then(function(){return t.throwIfInterrupted(),a.progress=B,Q(R,U)}).then(function(){t.throwIfInterrupted(),B.completedWords++;var l=Promise.resolve();return n.reduce(function(p,M,I){return l=l.then(function(){return M.K<p.K?Promise.resolve().then(function(){return Q(R,{name:"clear"})}).then(function(){var A=Promise.resolve(),N=p.K/M.K;return n.slice(0,I).forEach(function(P){A=A.then(function(){return P.M*=N,Q(R,{name:"put",args:[P.T,P.R,P.U]})})}),A}):Q(R,{name:"put",args:[p.T,p.R,p.U]})}).then(function(){return M._=T,Q(R,{name:"findFit",args:[M.T,M.R,M.U]})}).then(function(A){var N=A[0],P=A[1];t.throwIfInterrupted(),B.completedWords++,M.R=N,M.U=P,M._=0}),M}),l}).then(function(){return Q(R,{name:"put",args:[y.T,y.R,y.U]})}).then(function(){return Q(R,{name:"getBounds"})}).then(function(l){var p=l.left,M=l.top,I=l.width,A=l.height;if(I>0&&A>0){var N=Math.min(e/I,s/A);n.forEach(function(k){k.O-=p,k.W-=M,k.M*=N})}var P=new Set;return n.map(function(k){for(var _t=k.J,ht=k.t,xt=k.G,kt=k.i,St=k.o,Ft=k.u,Ot=k.s,Wt=k.h,Et=k.S,Rt=k.O,At=k.W,jt=k.I,rt=JSON.stringify([ht,St,Ft,Ot,Wt]);P.has(rt);)rt+="!";return P.add(rt),{key:rt,word:_t,text:ht,weight:xt,rotation:kt,font:Et,color:jt,left:Rt,top:At}})}).finally(function(){R.terminate()}).finally(function(){t.throwIfInterrupted(),a.progress=null})}return[]})}return[]},default:Ct}})],props:Vt,data:function(){return{elementWidth:0,elementHeight:0,progress:null}},computed:qt,watch:Jt,mounted:function(){var t,r,a=this;t=function(){if(a._isDestroyed)return!1;a.updateElementSize()},r=1e3,function(o){var e=function(){for(var s=[],n=arguments.length;n--;)s[n]=arguments[n];return o.call.apply(o,[this,e].concat(s))};return e}(function(o){requestAnimationFrame(function(){t()!==!1&&setTimeout(o,r)})})()},methods:Kt,render:function(){var t=this.$slots,r=this.animationEasing,a=this.animationOptions,o=this.cloudWords,e=this.separateAnimationDelay,s=this.separateAnimationDuration;return t=Object.assign({},{default:function(n){return n.text}},t),Y("div",{style:{height:"100%",position:"relative",width:"100%"}},[Y("div",{style:{bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"}},o.map(function(n,f){var b=n.color,c=n.font,v=n.left,F=n.rotation,E=n.text,S=n.top,g=n.weight,j=n.word;return Y("transition",Object.assign({},a),[Y("div",{key:f,style:Object.assign({},{left:v+"px",position:"absolute",top:S+"px"},s>0?{animation:[s+"ms",r,e*f+"ms"].join(" "),transition:["all",s+"ms",r,e*f+"ms"].join(" ")}:{})},[Y("div",{style:Object.assign({},{bottom:"50%",color:b,font:c,position:"absolute",right:"50%",transform:["translate(50%,50%)","rotate("+F+"rad)"].join(" "),whiteSpace:"nowrap"},s>0?{transition:["all",s+"ms",r,e*f+"ms"].join(" ")}:{})},[t.default({color:b,font:c,left:v,text:E,top:S,weight:g,word:j})])])])}))])}};const Zt={__name:"PollPlayerAnalysis",setup(t){nt.register(...Ut);const r=Lt(),a=It(),o="wss://nem.bio:4000",e=Z({value:{type:"",options:[],responses:[],correctResponse:""}}),s=Z(null),n=Z(null);let f=null;const b=Z(null);let c=null;const v=Z(null);let F=null;const E=Z(null);let S=null,g=null;const j=()=>{g=new WebSocket(`${o}/ws`);let m=0;const C=5,h=2e3;g.onopen=()=>{g.send(JSON.stringify({type:"fetch_poll",accessKey:a.query.accessKey,sessionId:a.query.sessionId})),m=0},g.onmessage=i=>{try{const w=JSON.parse(i.data);r.resource=w.resource,localStorage.setItem("pollResource",JSON.stringify(w.resource));const O=JSON.parse(w.resource.content),_=O.pollArray||[],z=O.activeQuestion.qstId;e.value=_.find(u=>u.qstId===z),U()}catch(w){console.error("Error parsing WebSocket message:",w)}},g.onerror=i=>console.error("WebSocket error:",i),g.onclose=()=>{m<C?setTimeout(()=>{m++,j()},h):console.error("Max reconnect attempts reached.")}};Pt(()=>{j()}),Dt(()=>{g&&g.close()});const T=()=>{const m=e.value.responses;return(m.reduce((h,i)=>h+i,0)/m.length).toFixed(1)},$=()=>{if(!n.value){console.error("singleChoiceChart canvas element is not available.");return}const m=n.value.getContext("2d"),C=e.value.options.map(i=>({option:i,count:e.value.responses.filter(w=>w===i).length})),h={labels:C.map(i=>`${i.option} (${i.count})`),datasets:[{label:"Poll Results",data:C.map(i=>i.count),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0"]}]};f?(f.data=h,f.update()):f=new nt(m,{type:"pie",data:h,options:{plugins:{tooltip:{callbacks:{label:function(i){const w=i.label||"",O=i.raw||0;return`${w}: ${O}`}}}}}})},q=()=>{if(!b.value){console.error("multipleChoiceChart canvas element is not available.");return}const m=e.value.options.map(_=>_.trim()),C=e.value.responses.map(_=>_.trim()),h=e.value.correctResponse.split(",").map(_=>_.trim()),i=m.map(_=>{const z=C.filter(y=>y===_).length,u=h.includes(_)?z:0;return{total:z,correct:u}}),w=b.value.getContext("2d"),O={labels:m,datasets:[{label:"Total Responses",data:i.map(_=>_.total),backgroundColor:"#36A2EB"},{label:"Correct Responses",data:i.map(_=>_.correct),backgroundColor:"#4CAF50"}]};c?(c.data=O,c.update()):c=new nt(w,{type:"bar",data:O,options:{scales:{y:{beginAtZero:!0}}}})},L=()=>{if(!v.value){console.error("ratingChart canvas element is not available.");return}const m=v.value.getContext("2d"),C={labels:["Rating"],datasets:[{data:[T(),5-T()],backgroundColor:["#FFCE56","#DDDDDD"]}]};F?(F.data=C,F.update()):F=new nt(m,{type:"doughnut",data:C})},G=()=>{if(!E.value){console.error("rankingChart canvas element is not available.");return}const m=E.value.getContext("2d"),C={labels:e.value.options,datasets:[{label:"Ranking",data:e.value.responses.map(h=>e.value.responses.indexOf(h)+1),backgroundColor:"#FF6384"}]};S?(S.data=C,S.update()):S=new nt(m,{type:"bar",data:C,options:{scales:{y:{beginAtZero:!0}}}})},U=async()=>{await pt(),e.value.type==="Single Choice"?$():e.value.type==="Multiple Choice"?q():e.value.type==="Rating"?L():e.value.type==="Ranking"?G():e.value.type==="Open-Ended"&&J()},J=async()=>{if(await pt(),!s.value){console.error("WordCloud canvas element is not defined.");return}const m=e.value.responses.map(i=>i.text);if(m.length===0){console.warn("No responses available for word cloud.");return}const h=m.join(" ").split(/\s+/).map(i=>[i,1]);WordCloud(s.value,{list:h,gridSize:10,weightFactor:5,color:"random-light",backgroundColor:"#fff"})};return(m,C)=>{const h=st("v-container"),i=st("v-col"),w=st("v-row");return X(),Bt(Tt,null,[e.value.type==="Single Choice"?(X(),tt(h,{key:0,class:"poll-container"},{default:K(()=>[ot("canvas",{ref_key:"singleChoiceChart",ref:n},null,512)]),_:1})):et("",!0),e.value.type==="Multiple Choice"?(X(),tt(h,{key:1,class:"poll-container"},{default:K(()=>[ot("canvas",{ref_key:"multipleChoiceChart",ref:b},null,512)]),_:1})):et("",!0),e.value.type==="Rating"?(X(),tt(h,{key:2,class:"poll-container"},{default:K(()=>[ot("canvas",{ref_key:"ratingChart",ref:v},null,512)]),_:1})):et("",!0),e.value.type==="Ranking"?(X(),tt(h,{key:3,class:"poll-container"},{default:K(()=>[ot("canvas",{ref_key:"rankingChart",ref:E},null,512)]),_:1})):et("",!0),e.value.type==="Open-Ended"?(X(),tt(h,{key:4,class:"poll-container"},{default:K(()=>[ut(w,null,{default:K(()=>[ut(i,null,{default:K(()=>[ut(Nt(Qt),{class:"ma-4",style:{height:"45vh"},words:e.value.responses,color:([,O])=>O>10?"DeepPink":O>5?"RoyalBlue":"Indigo","font-family":"Roboto"},null,8,["words","color"])]),_:1})]),_:1})]),_:1})):et("",!0)],64)}}},ne=Ht(Zt,[["__scopeId","data-v-4d180df2"]]);export{ne as L};
